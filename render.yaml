services:
  # Flask Backend API
  - type: web
    name: gtu-backend-api
    env: python
    region: oregon
    plan: free
    buildCommand: "pip install --upgrade pip && pip install supabase==2.4.5 && pip install python-dotenv==1.0.0 && pip install bcrypt==4.1.2 && pip install Flask-JWT-Extended==4.5.3 && pip install openai==1.14.0 && pip install bytez==0.1.0 && pip install Flask==3.0.0 && pip install flask-cors==4.0.0 && pip install requests==2.28.2 && pip install gunicorn==21.2.0"
    startCommand: "gunicorn -w 4 -b 0.0.0.0:$PORT backend.app:app"
    envVars:
      - key: FLASK_ENV
        value: production
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_KEY
        sync: false
      - key: GOOGLE_API_KEY
        sync: false
      - key: BYTEZ_API_KEY
        sync: false
    healthCheckPath: /api/subjects

  # FastAPI AI Agent Service
  - type: web
    name: gtu-ai-agent
    env: python
    region: oregon
    plan: free
    buildCommand: "pip install --upgrade pip && pip install supabase==2.4.5 && pip install python-dotenv==1.0.0 && pip install bcrypt==4.1.2 && pip install Flask-JWT-Extended==4.5.3 && pip install openai==1.14.0 && pip install bytez==0.1.0 && pip install fastapi==0.109.0 && pip install uvicorn==0.27.0 && pip install fpdf==1.7.2 && pip install apscheduler==3.10.4 && pip install youtube-transcript-api==0.6.2 && pip install beautifulsoup4==4.12.2 && pip install reportlab==4.0.9 && pip install google-generativeai>=0.8.0"
    startCommand: "uvicorn agent:app --host 0.0.0.0 --port $PORT"
    envVars:
      - key: BYTEZ_API_KEY
        sync: false
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_KEY
        sync: false
      - key: GOOGLE_API_KEY
        sync: false