services:
  # Flask Backend API
  - type: web
    name: gtu-backend-api
    env: python
    region: oregon
    plan: free
    buildCommand: "pip install --upgrade pip && pip install -r requirements.txt"
    startCommand: "gunicorn -w 4 -b 0.0.0.0:$PORT backend.app:app"
    envVars:
      - key: FLASK_ENV
        value: production
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_KEY
        sync: false
      - key: GOOGLE_API_KEY
        sync: false

  # Voice Gateway Service
  - type: web
    name: gtu-voice-gateway
    env: node
    region: oregon
    plan: free
    repo: https://github.com/glboysagar1-prog/gtu-exam-prep
    buildCommand: "cd voice-chat/gateway && npm install"
    startCommand: "cd voice-chat/gateway && node server.js"
    envVars:
      - key: DEEPGRAM_API_KEY
        sync: false
      - key: PUTER_URL
        fromService:
          type: web
          name: gtu-voice-puter
          property: url

  # Voice Puter Service
  - type: web
    name: gtu-voice-puter
    env: node
    region: oregon
    plan: free
    repo: https://github.com/glboysagar1-prog/gtu-exam-prep
    buildCommand: "cd voice-chat/puter && npm install"
    startCommand: "cd voice-chat/puter && node app.js"
    envVars:
      - key: BYTEZ_API_KEY
        sync: false
      - key: DEEPGRAM_API_KEY
        sync: false
      - key: GATEWAY_PLAYBACK
        fromService:
          type: web
          name: gtu-voice-gateway
          envVarKey: RENDER_EXTERNAL_URL
        value: "/playback"
      - key: BYTEZ_API_KEY
        sync: false
    healthCheckPath: /api/subjects

  # FastAPI AI Agent Service
  - type: web
    name: gtu-ai-agent
    env: python
    region: oregon
    plan: free
    buildCommand: "pip install --upgrade pip && pip install -r requirements.txt"
    startCommand: "uvicorn agent:app --host 0.0.0.0 --port $PORT"
    envVars:
      - key: BYTEZ_API_KEY
        sync: false
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_KEY
        sync: false
      - key: GOOGLE_API_KEY
        sync: false